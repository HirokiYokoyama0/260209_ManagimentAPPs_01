(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6013],{2449:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>d});var l=t(5155),a=t(7815),n=t(7e3);let i=e=>fetch(e).then(e=>e.json()),r={zero:"0個",oneTo4:"1〜4個",fiveTo9:"5〜9個",tenTo19:"10〜19個",twentyPlus:"20個以上"};function d(){let{data:e=[],error:s}=(0,a.Ay)("/api/profiles",i);if(s)return(0,l.jsx)("p",{className:"text-destructive",children:"分析用データの取得に失敗しました。しばらくしてから再試行してください。"});let t=e.length,d=e.reduce((e,s)=>{var t;return e+(null!=(t=s.stamp_count)?t:0)},0),x=e.filter(e=>!0===e.is_line_friend).length,u=t?Math.round(x/t*100):0,m=e.reduce((e,s)=>{var t;return e+(null!=(t=s.reservation_button_clicks)?t:0)},0),h=t?(m/t).toFixed(1):"0.0",f=Date.now(),j=e.filter(e=>{if(!e.updated_at)return!1;let s=Date.parse(e.updated_at);return!Number.isNaN(s)&&f-s<=12096e5}).length,b=e.map(e=>e.updated_at).filter(Boolean).sort().at(-1),p={zero:0,oneTo4:0,fiveTo9:0,tenTo19:0,twentyPlus:0};for(let s of e){var g;let e=null!=(g=s.stamp_count)?g:0;0===e?p.zero+=1:e<=4?p.oneTo4+=1:e<=9?p.fiveTo9+=1:e<=19?p.tenTo19+=1:p.twentyPlus+=1}let N=Math.max(...Object.values(p),1);return(0,l.jsxs)("div",{className:"space-y-8",children:[(0,l.jsxs)("header",{className:"space-y-1",children:[(0,l.jsx)("h1",{className:"text-2xl font-bold",children:"利用状況の分析"}),(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:"Supabase の `profiles` をもとに、スタンプの分布と友だち登録・最新ログイン状況を集計しています。"})]}),(0,l.jsxs)("section",{className:"grid gap-4 md:grid-cols-5",children:[(0,l.jsx)(c,{label:"登録ユーザー数",value:t.toLocaleString(),sub:"profiles テーブルの件数"}),(0,l.jsx)(c,{label:"スタンプ総数",value:d.toLocaleString(),sub:"stamp_count の合計"}),(0,l.jsx)(c,{label:"予約ボタンクリック数",value:"".concat(m.toLocaleString(),"回"),sub:"平均 ".concat(h,"回/人")}),(0,l.jsx)(c,{label:"公式アカ友だち",value:"".concat(x.toLocaleString(),"人"),sub:"全体の ".concat(u,"%")}),(0,l.jsx)(c,{label:"直近14日でログイン",value:"".concat(j.toLocaleString(),"人"),sub:b?"最終ログイン: ".concat((0,n.B)(b)):"ログイン履歴なし"})]}),(0,l.jsxs)("section",{className:"rounded-xl border bg-white/90 p-6 shadow-sm",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,l.jsx)("h2",{className:"text-base font-semibold",children:"スタンプ数の分布"}),(0,l.jsx)("p",{className:"text-xs text-muted-foreground",children:"どのくらい通っている患者さんが多いかをざっくり把握できます。"})]}),(0,l.jsxs)("div",{className:"grid gap-4 md:grid-cols-[minmax(0,1.6fr)_minmax(0,1fr)]",children:[(0,l.jsx)("div",{className:"space-y-3",children:Object.entries(p).map(e=>{let[s,t]=e,a=0===t?0:t/N;return(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center justify-between text-xs mb-1",children:[(0,l.jsx)("span",{className:"font-medium",children:r[s]}),(0,l.jsxs)("span",{className:"text-muted-foreground",children:[t,"人"]})]}),(0,l.jsx)("div",{className:"h-2.5 rounded-full bg-slate-100 overflow-hidden",children:(0,l.jsx)("div",{className:"h-full rounded-full bg-sky-500",style:{width:"".concat(100*a,"%")}})})]},s)})}),(0,l.jsxs)("div",{className:"space-y-3 text-xs text-muted-foreground",children:[(0,l.jsx)("p",{className:"font-medium text-sm text-foreground",children:"メモ"}),(0,l.jsxs)("ul",{className:"list-disc pl-4 space-y-1.5",children:[(0,l.jsx)("li",{children:"スタンプ数が多いほど「来院頻度が高い患者さん」です。"}),(0,l.jsx)("li",{children:"`0個` が多い場合は、初診だけの方が多い可能性があります。"}),(0,l.jsx)("li",{children:"将来的に「スタンプ◯個以上の方へ一斉メッセージ」などの条件に使えます。"})]})]})]})]}),(0,l.jsxs)("section",{className:"rounded-xl border bg-white/90 p-6 shadow-sm",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,l.jsx)("h2",{className:"text-base font-semibold",children:"友だち登録と直近14日のアクティブ"}),(0,l.jsx)("p",{className:"text-xs text-muted-foreground",children:"公式アカウントの友だち登録状況と、直近2週間のアクティブユーザー数です。"})]}),(0,l.jsxs)("div",{className:"grid gap-6 md:grid-cols-2",children:[(0,l.jsx)(o,{label:"公式アカ友だち",total:t,active:x,activeLabel:"友だち",inactiveLabel:"未友だち",color:"bg-emerald-500"}),(0,l.jsx)(o,{label:"直近14日でログイン",total:t,active:j,activeLabel:"直近14日内",inactiveLabel:"14日以上ログインなし",color:"bg-indigo-500"})]})]})]})}function c(e){return(0,l.jsxs)("div",{className:"rounded-xl border bg-white/90 p-4 shadow-sm",children:[(0,l.jsx)("p",{className:"text-xs font-medium text-muted-foreground mb-1",children:e.label}),(0,l.jsx)("p",{className:"text-xl font-semibold tracking-tight mb-1",children:e.value}),e.sub&&(0,l.jsx)("p",{className:"text-[11px] text-muted-foreground",children:e.sub})]})}function o(e){let{label:s,total:t,active:a,activeLabel:n,inactiveLabel:i,color:r}=e,d=t?a/t:0;return(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("p",{className:"text-sm font-medium text-foreground",children:s}),(0,l.jsx)("div",{className:"h-3 rounded-full bg-slate-100 overflow-hidden flex",children:(0,l.jsx)("div",{className:"".concat(r," h-full transition-all"),style:{width:"".concat(100*d,"%")}})}),(0,l.jsxs)("div",{className:"flex justify-between text-[11px] text-muted-foreground",children:[(0,l.jsxs)("span",{children:[n,": ",(0,l.jsx)("span",{className:"font-semibold text-foreground",children:a})]}),(0,l.jsxs)("span",{children:[i,": ",(0,l.jsx)("span",{className:"font-semibold text-foreground",children:t-a})]})]})]})}},7e3:(e,s,t)=>{"use strict";function l(e){let s=new Date(e);return new Intl.DateTimeFormat("ja-JP",{timeZone:"Asia/Tokyo",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(s)}t.d(s,{B:()=>l})},9075:(e,s,t)=>{Promise.resolve().then(t.bind(t,2449))}},e=>{e.O(0,[7815,8441,1255,7358],()=>e(e.s=9075)),_N_E=e.O()}]);