(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1531],{1847:(e,s,r)=>{"use strict";r.d(s,{A:()=>i});var t=r(2115);let a=function(){for(var e=arguments.length,s=Array(e),r=0;r<e;r++)s[r]=arguments[r];return s.filter((e,s,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===s).join(" ").trim()};var l={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(0,t.forwardRef)((e,s)=>{let{color:r="currentColor",size:n=24,strokeWidth:i=2,absoluteStrokeWidth:d,className:c="",children:o,iconNode:m,...x}=e;return(0,t.createElement)("svg",{ref:s,...l,width:n,height:n,stroke:r,strokeWidth:d?24*Number(i)/Number(n):i,className:a("lucide",c),...x},[...m.map(e=>{let[s,r]=e;return(0,t.createElement)(s,r)}),...Array.isArray(o)?o:[o]])}),i=(e,s)=>{let r=(0,t.forwardRef)((r,l)=>{let{className:i,...d}=r;return(0,t.createElement)(n,{ref:l,iconNode:s,className:a("lucide-".concat(e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),i),...d})});return r.displayName="".concat(e),r}},5016:(e,s,r)=>{"use strict";r.d(s,{cn:()=>l});var t=r(2821),a=r(5889);function l(){for(var e=arguments.length,s=Array(e),r=0;r<e;r++)s[r]=arguments[r];return(0,a.QP)((0,t.$)(s))}},5035:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>A});var t=r(5155),a=r(2115),l=r(7815),n=r(1847);let i=(0,n.A)("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]),d=(0,n.A)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);var c=r(6651),o=r(5299),m=r(5917),x=r(5229);let h=(0,n.A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);var u=r(7003),g=r(6170),f=r(7812),p=r(6633),b=r(7e3);function j(e){let{exchangeId:s,status:r,onComplete:a,onCancel:l,onDelete:n,isProcessing:i}=e;return"pending"!==r?(0,t.jsxs)(u.$,{size:"sm",variant:"outline",className:"w-full border-red-300 text-red-700 hover:bg-red-50",onClick:()=>n(s),disabled:i,children:[(0,t.jsx)(h,{className:"h-4 w-4 mr-1"}),"削除"]}):(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,t.jsxs)(u.$,{size:"sm",className:"bg-emerald-600 hover:bg-emerald-700 text-white",onClick:()=>a(s),disabled:i,children:[(0,t.jsx)(m.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"hidden sm:inline ml-1",children:"完了"})]}),(0,t.jsxs)(u.$,{size:"sm",variant:"outline",className:"border-orange-300 text-orange-700 hover:bg-orange-50",onClick:()=>l(s),disabled:i,children:[(0,t.jsx)(x.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"hidden sm:inline ml-1",children:"キャンセル"})]}),(0,t.jsxs)(u.$,{size:"sm",variant:"outline",className:"border-red-300 text-red-700 hover:bg-red-50",onClick:()=>n(s),disabled:i,children:[(0,t.jsx)(h,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"hidden sm:inline ml-1",children:"削除"})]})]})}let v=(0,n.A)("Award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]),y=(0,n.A)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),N={pending:{label:"未引渡",variant:"default",color:"bg-blue-100 text-blue-800"},completed:{label:"引渡完了",variant:"secondary",color:"bg-emerald-100 text-emerald-800"},cancelled:{label:"キャンセル",variant:"destructive",color:"bg-red-100 text-red-800"}};function w(e){let{exchange:s,onComplete:r,onCancel:a,onDelete:l,isProcessing:n}=e,d=N[s.status];return(0,t.jsxs)("div",{className:"bg-white rounded-lg border shadow-sm p-4 space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-0.5 mb-1",children:[(0,t.jsx)("h3",{className:"font-semibold text-base truncate",children:s.user_name||"—"}),s.user_medical_record_number&&(0,t.jsxs)("span",{className:"text-xs text-slate-500",children:["診察券: ",s.user_medical_record_number]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[(0,t.jsx)(i,{className:"h-3.5 w-3.5 shrink-0"}),(0,t.jsx)("span",{className:"truncate",children:s.reward_name})]})]}),(0,t.jsx)(f.E,{className:"".concat(d.color," shrink-0 ml-2"),children:d.label})]}),(0,t.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(v,{className:"h-4 w-4 text-muted-foreground shrink-0"}),(0,t.jsx)("span",{className:"text-muted-foreground",children:"スタンプ数:"}),(0,t.jsxs)("span",{className:"font-semibold",children:[s.stamp_count_used,"個"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(y,{className:"h-4 w-4 text-muted-foreground shrink-0"}),(0,t.jsx)("span",{className:"text-muted-foreground",children:"交換日時:"}),(0,t.jsx)("span",{className:"font-medium",children:(0,b.B)(s.exchanged_at)})]})]}),(0,t.jsx)("div",{className:"pt-2 border-t",children:(0,t.jsx)(j,{exchangeId:s.id,status:s.status,onComplete:r,onCancel:a,onDelete:l,isProcessing:n})})]})}function k(e){let{exchanges:s,isLoading:r,processingId:a,onComplete:l,onCancel:n,onDelete:i}=e;return r?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-16 space-y-4",children:[(0,t.jsx)(o.A,{className:"h-12 w-12 text-sky-500 animate-spin"}),(0,t.jsx)("p",{className:"text-muted-foreground text-sm",children:"読み込み中..."})]}):0===s.length?(0,t.jsx)("div",{className:"text-center text-muted-foreground py-8 bg-white rounded-lg border",children:"該当する交換履歴がありません。"}):(0,t.jsx)("div",{className:"space-y-3",children:s.map(e=>(0,t.jsx)(w,{exchange:e,onComplete:l,onCancel:n,onDelete:i,isProcessing:a===e.id},e.id))})}let _=e=>fetch(e).then(e=>e.json());function A(){let[e,s]=(0,a.useState)("all"),[r,n]=(0,a.useState)(""),[b,j]=(0,a.useState)(null),v=new URLSearchParams;"all"!==e&&v.set("status",e),r&&v.set("search",r);let{data:y,error:N,mutate:w,isLoading:A}=(0,l.Ay)("/api/reward-exchanges?".concat(v.toString()),_),C=(null==y?void 0:y.exchanges)||[],E=async e=>{let s=prompt("担当者名を入力してください（例: 田中）");if(s){j(e);try{(await fetch("/api/reward-exchanges/".concat(e,"/complete"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({completedBy:s})})).ok?(alert("引き渡し完了しました"),w()):alert("エラーが発生しました")}catch(e){console.error("Error completing exchange:",e),alert("エラーが発生しました")}finally{j(null)}}},T=async e=>{let s=prompt("キャンセル理由を入力してください（例: 在庫切れ）");if(s&&confirm("キャンセルしますか？（スタンプは返却されません）")){j(e);try{(await fetch("/api/reward-exchanges/".concat(e,"/cancel"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({notes:s})})).ok?(alert("キャンセルしました"),w()):alert("エラーが発生しました")}catch(e){console.error("Error cancelling exchange:",e),alert("エラーが発生しました")}finally{j(null)}}},z=async e=>{if(confirm("この交換履歴を完全に削除しますか？この操作は取り消せません。")){j(e);try{(await fetch("/api/reward-exchanges/".concat(e,"/delete"),{method:"DELETE"})).ok?(alert("削除しました"),w()):alert("エラーが発生しました")}catch(e){console.error("Error deleting exchange:",e),alert("エラーが発生しました")}finally{j(null)}}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-gradient-to-br from-purple-500 to-pink-500 text-white shadow-sm",children:(0,t.jsx)(i,{className:"h-5 w-5"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-slate-800",children:"特典交換履歴"}),(0,t.jsx)("p",{className:"text-sm text-slate-500",children:"患者がスタンプを使って交換した特典を管理"})]})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-3 rounded-xl bg-white p-4 shadow-sm ring-1 ring-slate-100 sm:flex-row",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(d,{className:"h-4 w-4 text-slate-400"}),(0,t.jsxs)("select",{value:e,onChange:e=>s(e.target.value),className:"rounded-lg border border-slate-200 px-3 py-1.5 text-sm focus:border-sky-500 focus:outline-none focus:ring-2 focus:ring-sky-500/20",children:[(0,t.jsx)("option",{value:"all",children:"全ステータス"}),(0,t.jsx)("option",{value:"pending",children:"未引渡のみ"}),(0,t.jsx)("option",{value:"completed",children:"引渡済のみ"}),(0,t.jsx)("option",{value:"cancelled",children:"キャンセルのみ"})]})]}),(0,t.jsxs)("div",{className:"relative flex-1",children:[(0,t.jsx)(c.A,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-400"}),(0,t.jsx)(g.p,{type:"text",placeholder:"患者名・診察券番号・特典名で検索...",value:r,onChange:e=>n(e.target.value),className:"pl-9"})]})]}),(0,t.jsx)("div",{className:"hidden lg:block rounded-xl bg-white shadow-sm ring-1 ring-slate-100",children:A?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-16 space-y-4",children:[(0,t.jsx)(o.A,{className:"h-12 w-12 text-purple-500 animate-spin"}),(0,t.jsx)("p",{className:"text-muted-foreground text-sm",children:"データを読み込んでいます..."})]}):N?(0,t.jsx)("div",{className:"p-8 text-center text-red-500",children:"エラーが発生しました"}):0===C.length?(0,t.jsx)("div",{className:"p-8 text-center text-slate-500",children:"交換履歴がありません"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(p.XI,{children:[(0,t.jsx)(p.A0,{children:(0,t.jsxs)(p.Hj,{children:[(0,t.jsx)(p.nd,{children:"患者名"}),(0,t.jsx)(p.nd,{children:"特典名"}),(0,t.jsx)(p.nd,{className:"text-center",children:"スタンプ数"}),(0,t.jsx)(p.nd,{children:"交換日時"}),(0,t.jsx)(p.nd,{className:"text-center",children:"ステータス"}),(0,t.jsx)(p.nd,{className:"text-right",children:"操作"})]})}),(0,t.jsx)(p.BF,{children:C.map(e=>(0,t.jsxs)(p.Hj,{children:[(0,t.jsx)(p.nA,{className:"font-medium",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[e.user_picture_url&&(0,t.jsx)("img",{src:e.user_picture_url,alt:e.user_name,className:"h-8 w-8 rounded-full"}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{children:e.user_name}),e.user_medical_record_number&&(0,t.jsxs)("span",{className:"text-xs text-slate-500",children:["診察券: ",e.user_medical_record_number]})]})]})}),(0,t.jsx)(p.nA,{children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[e.reward_image_url&&(0,t.jsx)("img",{src:e.reward_image_url,alt:e.reward_name,className:"h-8 w-8 rounded object-cover"}),(0,t.jsx)("span",{children:e.reward_name})]})}),(0,t.jsx)(p.nA,{className:"text-center",children:(0,t.jsx)("span",{className:"font-semibold text-purple-600",children:e.stamp_count_used})}),(0,t.jsx)(p.nA,{className:"text-sm text-slate-600",children:new Date(e.exchanged_at).toLocaleString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),(0,t.jsx)(p.nA,{className:"text-center",children:(e=>{switch(e){case"pending":return(0,t.jsx)(f.E,{className:"bg-amber-100 text-amber-700 hover:bg-amber-100",children:"未引渡"});case"completed":return(0,t.jsx)(f.E,{className:"bg-green-100 text-green-700 hover:bg-green-100",children:"引渡済"});case"cancelled":return(0,t.jsx)(f.E,{className:"bg-gray-100 text-gray-600 hover:bg-gray-100",children:"キャンセル"});default:return(0,t.jsx)(f.E,{children:e})}})(e.status)}),(0,t.jsxs)(p.nA,{className:"text-right",children:["pending"===e.status&&(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsxs)(u.$,{size:"sm",variant:"outline",onClick:()=>E(e.id),disabled:b===e.id,className:"border-green-200 text-green-700 hover:bg-green-50",children:[(0,t.jsx)(m.A,{className:"mr-1 h-3 w-3"}),"完了"]}),(0,t.jsxs)(u.$,{size:"sm",variant:"outline",onClick:()=>T(e.id),disabled:b===e.id,className:"border-amber-200 text-amber-700 hover:bg-amber-50",children:[(0,t.jsx)(x.A,{className:"mr-1 h-3 w-3"}),"キャンセル"]}),(0,t.jsxs)(u.$,{size:"sm",variant:"outline",onClick:()=>z(e.id),disabled:b===e.id,className:"border-red-200 text-red-700 hover:bg-red-50",children:[(0,t.jsx)(h,{className:"mr-1 h-3 w-3"}),"削除"]})]}),("completed"===e.status||"cancelled"===e.status)&&(0,t.jsxs)("div",{className:"flex justify-end gap-2 items-center",children:[(0,t.jsx)("span",{className:"text-xs text-slate-500",children:"completed"===e.status?"引渡済":"キャンセル済"}),(0,t.jsxs)(u.$,{size:"sm",variant:"outline",onClick:()=>z(e.id),disabled:b===e.id,className:"border-red-200 text-red-700 hover:bg-red-50",children:[(0,t.jsx)(h,{className:"mr-1 h-3 w-3"}),"削除"]})]})]})]},e.id))})]}),(0,t.jsxs)("div",{className:"border-t border-slate-100 px-6 py-3 text-sm text-slate-500",children:["表示件数: ",C.length,"件"]})]})}),(0,t.jsx)("div",{className:"block lg:hidden",children:(0,t.jsx)(k,{exchanges:C,isLoading:A,processingId:b,onComplete:E,onCancel:T,onDelete:z})})]})}},5229:(e,s,r)=>{"use strict";r.d(s,{A:()=>t});let t=(0,r(1847).A)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},5299:(e,s,r)=>{"use strict";r.d(s,{A:()=>t});let t=(0,r(1847).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},5917:(e,s,r)=>{"use strict";r.d(s,{A:()=>t});let t=(0,r(1847).A)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},6170:(e,s,r)=>{"use strict";r.d(s,{p:()=>n});var t=r(5155),a=r(2115),l=r(5016);let n=a.forwardRef((e,s)=>{let{className:r,type:a,...n}=e;return(0,t.jsx)("input",{type:a,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:s,...n})});n.displayName="Input"},6633:(e,s,r)=>{"use strict";r.d(s,{A0:()=>i,BF:()=>d,Hj:()=>c,XI:()=>n,nA:()=>m,nd:()=>o});var t=r(5155),a=r(2115),l=r(5016);let n=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("div",{className:"relative w-full overflow-auto",children:(0,t.jsx)("table",{ref:s,className:(0,l.cn)("w-full caption-bottom text-sm",r),...a})})});n.displayName="Table";let i=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("thead",{ref:s,className:(0,l.cn)("[&_tr]:border-b",r),...a})});i.displayName="TableHeader";let d=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("tbody",{ref:s,className:(0,l.cn)("[&_tr:last-child]:border-0",r),...a})});d.displayName="TableBody";let c=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("tr",{ref:s,className:(0,l.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",r),...a})});c.displayName="TableRow";let o=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("th",{ref:s,className:(0,l.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",r),...a})});o.displayName="TableHead";let m=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("td",{ref:s,className:(0,l.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",r),...a})});m.displayName="TableCell"},6651:(e,s,r)=>{"use strict";r.d(s,{A:()=>t});let t=(0,r(1847).A)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},7e3:(e,s,r)=>{"use strict";function t(e){let s=new Date(e);return new Intl.DateTimeFormat("ja-JP",{timeZone:"Asia/Tokyo",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(s)}r.d(s,{B:()=>t})},7003:(e,s,r)=>{"use strict";r.d(s,{$:()=>c});var t=r(5155),a=r(2115),l=r(2467),n=r(3101),i=r(5016);let d=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef((e,s)=>{let{className:r,variant:a,size:n,asChild:c=!1,...o}=e,m=c?l.DX:"button";return(0,t.jsx)(m,{className:(0,i.cn)(d({variant:a,size:n,className:r})),ref:s,...o})});c.displayName="Button"},7812:(e,s,r)=>{"use strict";r.d(s,{E:()=>i});var t=r(5155);r(2115);var a=r(3101),l=r(5016);let n=(0,a.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground",secondary:"border-transparent bg-secondary text-secondary-foreground",destructive:"border-transparent bg-destructive text-destructive-foreground",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:s,variant:r,...a}=e;return(0,t.jsx)("div",{className:(0,l.cn)(n({variant:r}),s),...a})}},9757:(e,s,r)=>{Promise.resolve().then(r.bind(r,5035))}},e=>{e.O(0,[5707,7815,8441,1255,7358],()=>e(e.s=9757)),_N_E=e.O()}]);