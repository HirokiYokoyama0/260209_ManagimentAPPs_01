(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3864],{1169:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(1847).A)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},1847:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});var r=s(2115);let a=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.filter((e,t,s)=>!!e&&""!==e.trim()&&s.indexOf(e)===t).join(" ").trim()};var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,r.forwardRef)((e,t)=>{let{color:s="currentColor",size:l=24,strokeWidth:i=2,absoluteStrokeWidth:c,className:d="",children:o,iconNode:m,...u}=e;return(0,r.createElement)("svg",{ref:t,...n,width:l,height:l,stroke:s,strokeWidth:c?24*Number(i)/Number(l):i,className:a("lucide",d),...u},[...m.map(e=>{let[t,s]=e;return(0,r.createElement)(t,s)}),...Array.isArray(o)?o:[o]])}),i=(e,t)=>{let s=(0,r.forwardRef)((s,n)=>{let{className:i,...c}=s;return(0,r.createElement)(l,{ref:n,iconNode:t,className:a("lucide-".concat(e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),i),...c})});return s.displayName="".concat(e),s}},5016:(e,t,s)=>{"use strict";s.d(t,{cn:()=>n});var r=s(2821),a=s(5889);function n(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,a.QP)((0,r.$)(t))}},5299:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(1847).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},5516:(e,t,s)=>{Promise.resolve().then(s.bind(s,8356))},6633:(e,t,s)=>{"use strict";s.d(t,{A0:()=>i,BF:()=>c,Hj:()=>d,XI:()=>l,nA:()=>m,nd:()=>o});var r=s(5155),a=s(2115),n=s(5016);let l=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{className:"relative w-full overflow-auto",children:(0,r.jsx)("table",{ref:t,className:(0,n.cn)("w-full caption-bottom text-sm",s),...a})})});l.displayName="Table";let i=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("thead",{ref:t,className:(0,n.cn)("[&_tr]:border-b",s),...a})});i.displayName="TableHeader";let c=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("tbody",{ref:t,className:(0,n.cn)("[&_tr:last-child]:border-0",s),...a})});c.displayName="TableBody";let d=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("tr",{ref:t,className:(0,n.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...a})});d.displayName="TableRow";let o=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("th",{ref:t,className:(0,n.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...a})});o.displayName="TableHead";let m=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("td",{ref:t,className:(0,n.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...a})});m.displayName="TableCell"},7003:(e,t,s)=>{"use strict";s.d(t,{$:()=>d});var r=s(5155),a=s(2115),n=s(2467),l=s(3101),i=s(5016);let c=(0,l.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=a.forwardRef((e,t)=>{let{className:s,variant:a,size:l,asChild:d=!1,...o}=e,m=d?n.DX:"button";return(0,r.jsx)(m,{className:(0,i.cn)(c({variant:a,size:l,className:s})),ref:t,...o})});d.displayName="Button"},8356:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>p});var r=s(5155),a=s(2115),n=s(7815),l=s(1169),i=s(5299),c=s(9559),d=s(7003),o=s(6633);let m=e=>fetch(e).then(e=>e.json()),u={app_open:"アプリ起動",page_view:"ページ閲覧",session_start:"セッション開始",session_end:"セッション終了",stamp_page_view:"スタンプページ閲覧",stamp_scan_start:"QRスキャン開始",stamp_scan_success:"QRスキャン成功",stamp_scan_fail:"QRスキャン失敗",stamp_history_view:"スタンプ履歴閲覧",home_page_view:"診察券ページ閲覧",reward_list_view:"特典一覧閲覧",reward_detail_view:"特典詳細閲覧",reward_exchange_start:"特典交換開始",reward_exchange_success:"特典交換成功",reservation_button_click:"予約ボタンクリック",reservation_external_link:"外部予約サイトへ遷移",slot_game_open:"スロットゲーム開く",slot_game_play:"スロットゲームプレイ",slot_game_win:"スロットゲーム当たり",slot_game_lose:"スロットゲーム外れ",family_join_start:"家族参加開始",family_join_success:"家族参加成功",child_mode_open:"子供モード開く",child_mode_switch:"子供画面切替",error_occurred:"エラー発生",api_call_failed:"API呼び出し失敗"};function h(e){var t;let s=e.profile;return s?s.display_name||s.real_name||s.ticket_number||String(null!=(t=e.user_id)?t:"").slice(0,12)+"…":e.user_id?"".concat(String(e.user_id).slice(0,12),"…"):"—"}function x(e){if(!e||0===Object.keys(e).length)return"—";let t=[];return(void 0!==e.current_stamp_count&&t.push("スタンプ: ".concat(e.current_stamp_count)),void 0!==e.stamps_added&&t.push("+".concat(e.stamps_added)),void 0!==e.type&&t.push(String(e.type)),void 0!==e.result&&t.push(String(e.result)),void 0!==e.stamps_won&&t.push("獲得: ".concat(e.stamps_won)),void 0!==e.from_page&&t.push("from: ".concat(e.from_page)),void 0!==e.error&&t.push("err: ".concat(String(e.error).slice(0,20))),t.length>0)?t.join(", "):JSON.stringify(e).slice(0,60)+(JSON.stringify(e).length>60?"…":"")}function p(){var e;let[t,s]=(0,a.useState)(!1),{data:p,error:f,isLoading:v,mutate:g}=(0,n.Ay)(t?"/api/event-logs?limit=200":null,m,{refreshInterval:0});(0,a.useEffect)(()=>{s(!0)},[]);let _=null!=(e=null==p?void 0:p.logs)?e:[];return(0,r.jsxs)("div",{className:"max-w-6xl mx-auto space-y-6",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h1",{className:"text-xl font-semibold flex items-center gap-2",children:[(0,r.jsx)(l.A,{className:"h-5 w-5 text-slate-600"}),"ユーザログ"]}),(0,r.jsx)("p",{className:"text-sm text-slate-600 mt-1",children:"LIFFアプリでのユーザー行動ログ。アプリ起動・QRスキャン・予約クリック・ゲームプレイなどを記録しています。"})]}),(0,r.jsxs)(d.$,{variant:"outline",size:"sm",onClick:()=>g(),disabled:v,className:"shrink-0",children:[v?(0,r.jsx)(i.A,{className:"h-4 w-4 animate-spin"}):(0,r.jsx)(c.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"ml-2",children:"更新"})]})]}),(0,r.jsxs)("div",{className:"rounded-xl border border-slate-200 bg-white shadow-sm overflow-hidden",children:[f&&(0,r.jsx)("div",{className:"p-4 text-sm text-amber-700 bg-amber-50 border-b border-amber-100",children:"読み込みに失敗しました。event_logs テーブルが作成されているか確認し、しばらくしてから再試行してください。"}),v&&0===_.length?(0,r.jsx)("div",{className:"flex items-center justify-center py-16 text-slate-500",children:(0,r.jsx)(i.A,{className:"h-8 w-8 animate-spin"})}):0===_.length?(0,r.jsx)("div",{className:"py-16 text-center text-slate-500 text-sm",children:"まだユーザーログはありません。LIFFアプリで操作が行われると記録されます。"}):(0,r.jsxs)(o.XI,{children:[(0,r.jsx)(o.A0,{children:(0,r.jsxs)(o.Hj,{className:"bg-slate-50",children:[(0,r.jsx)(o.nd,{className:"w-[160px]",children:"日時"}),(0,r.jsx)(o.nd,{className:"min-w-[140px]",children:"ユーザー"}),(0,r.jsx)(o.nd,{className:"min-w-[140px]",children:"イベント"}),(0,r.jsx)(o.nd,{className:"w-[120px]",children:"流入元"}),(0,r.jsx)(o.nd,{children:"メタデータ"})]})}),(0,r.jsx)(o.BF,{children:_.map(e=>{var t;return(0,r.jsxs)(o.Hj,{className:"hover:bg-slate-50/50",children:[(0,r.jsx)(o.nA,{className:"text-slate-600 whitespace-nowrap text-xs",children:new Date(e.created_at).toLocaleString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}),(0,r.jsx)(o.nA,{className:"text-sm text-slate-800 max-w-[200px] truncate",title:h(e),children:h(e)}),(0,r.jsx)(o.nA,{className:"text-sm",children:null!=(t=u[e.event_name])?t:e.event_name}),(0,r.jsx)(o.nA,{className:"text-xs text-slate-600",children:e.source||"—"}),(0,r.jsx)(o.nA,{className:"text-xs text-slate-500 max-w-[220px] truncate",title:x(e.metadata),children:x(e.metadata)})]},e.id)})})]})]}),_.length>=200&&(0,r.jsx)("p",{className:"text-xs text-slate-500 text-center",children:"直近 200 件を表示しています。"})]})}},9559:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(1847).A)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])}},e=>{e.O(0,[5707,7815,8441,1255,7358],()=>e(e.s=5516)),_N_E=e.O()}]);