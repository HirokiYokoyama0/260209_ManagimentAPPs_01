(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2986],{1847:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var a=r(2115);let s=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,a.forwardRef)((e,t)=>{let{color:r="currentColor",size:l=24,strokeWidth:i=2,absoluteStrokeWidth:d,className:c="",children:o,iconNode:m,...u}=e;return(0,a.createElement)("svg",{ref:t,...n,width:l,height:l,stroke:r,strokeWidth:d?24*Number(i)/Number(l):i,className:s("lucide",c),...u},[...m.map(e=>{let[t,r]=e;return(0,a.createElement)(t,r)}),...Array.isArray(o)?o:[o]])}),i=(e,t)=>{let r=(0,a.forwardRef)((r,n)=>{let{className:i,...d}=r;return(0,a.createElement)(l,{ref:n,iconNode:t,className:s("lucide-".concat(e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),i),...d})});return r.displayName="".concat(e),r}},2334:(e,t,r)=>{Promise.resolve().then(r.bind(r,6310))},5016:(e,t,r)=>{"use strict";r.d(t,{cn:()=>n});var a=r(2821),s=r(5889);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.QP)((0,a.$)(t))}},5299:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(1847).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},6310:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var a=r(5155),s=r(2115),n=r(7815);let l=(0,r(1847).A)("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);var i=r(5299),d=r(9559),c=r(7003),o=r(6633),m=r(7812);let u=e=>fetch(e).then(e=>e.json()),f={login:"ログイン",logout:"ログアウト",profile_update:"患者情報更新",stamp_increment:"スタンプ加算",stamp_set:"スタンプ設定",message_send:"個別メッセージ送信",broadcast_send:"一斉配信",reward_exchange_complete:"特典引き渡し完了",reward_exchange_cancel:"特典交換キャンセル",reward_exchange_delete:"特典交換削除",family_create:"家族作成",family_update:"家族更新",family_delete:"家族削除",family_member_add:"家族メンバー追加",family_member_remove:"家族メンバー解除",staff_create:"スタッフ追加",staff_update:"スタッフ更新",staff_deactivate:"スタッフ無効化"},x={profile:"患者",reward_exchange:"特典交換",family:"家族",staff:"スタッフ"};function h(e){return e?e.length<=12?e:"".concat(e.slice(0,8),"…"):"—"}function p(e){let t=e.target_profile;if(!t)return"—";let r=t.display_name||t.real_name||t.ticket_number||null;return null!=r?r:"—"}function g(){var e;let[t,r]=(0,s.useState)(!1),{data:g,error:v,isLoading:b,mutate:y}=(0,n.Ay)(t?"/api/activity-logs?limit=200":null,u,{refreshInterval:0});(0,s.useEffect)(()=>{r(!0)},[]);let j=null!=(e=null==g?void 0:g.logs)?e:[];return(0,a.jsxs)("div",{className:"max-w-6xl mx-auto space-y-6",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-xl font-semibold flex items-center gap-2",children:[(0,a.jsx)(l,{className:"h-5 w-5 text-slate-600"}),"スタッフ操作ログ"]}),(0,a.jsx)("p",{className:"text-sm text-slate-600 mt-1",children:"誰が・いつ・何をしたかの記録。操作者が「admin」の行は従来の環境変数ログインの操作です。"})]}),(0,a.jsxs)(c.$,{variant:"outline",size:"sm",onClick:()=>y(),disabled:b,className:"shrink-0",children:[b?(0,a.jsx)(i.A,{className:"h-4 w-4 animate-spin"}):(0,a.jsx)(d.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"ml-2",children:"更新"})]})]}),(0,a.jsxs)("div",{className:"rounded-xl border border-slate-200 bg-white shadow-sm overflow-hidden",children:[v&&(0,a.jsx)("div",{className:"p-4 text-sm text-amber-700 bg-amber-50 border-b border-amber-100",children:"読み込みに失敗しました。しばらくしてから再試行してください。"}),b&&0===j.length?(0,a.jsx)("div",{className:"flex items-center justify-center py-16 text-slate-500",children:(0,a.jsx)(i.A,{className:"h-8 w-8 animate-spin"})}):0===j.length?(0,a.jsx)("div",{className:"py-16 text-center text-slate-500 text-sm",children:"まだ操作ログはありません。"}):(0,a.jsxs)(o.XI,{children:[(0,a.jsx)(o.A0,{children:(0,a.jsxs)(o.Hj,{className:"bg-slate-50",children:[(0,a.jsx)(o.nd,{className:"w-[160px]",children:"日時"}),(0,a.jsx)(o.nd,{className:"w-[120px]",children:"操作者"}),(0,a.jsx)(o.nd,{className:"min-w-[140px]",children:"操作"}),(0,a.jsx)(o.nd,{className:"w-[100px]",children:"対象"}),(0,a.jsx)(o.nd,{className:"min-w-[140px]",children:"詳細対象"}),(0,a.jsx)(o.nd,{children:"詳細"})]})}),(0,a.jsx)(o.BF,{children:j.map(e=>{var t,r,s;return(0,a.jsxs)(o.Hj,{className:"hover:bg-slate-50/50",children:[(0,a.jsx)(o.nA,{className:"text-slate-600 whitespace-nowrap text-xs",children:new Date(e.created_at).toLocaleString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}),(0,a.jsx)(o.nA,{children:null==e.staff_id?(0,a.jsx)(m.E,{variant:"secondary",className:"font-normal",children:"admin"}):e.staff?(0,a.jsx)("span",{className:"text-sm",children:e.staff.display_name||e.staff.login_id}):(0,a.jsx)("span",{className:"text-xs text-slate-400",children:h(e.staff_id)})}),(0,a.jsx)(o.nA,{className:"text-sm",children:null!=(t=f[e.action])?t:e.action}),(0,a.jsx)(o.nA,{className:"text-xs text-slate-600",children:e.target_type?"".concat(null!=(r=x[e.target_type])?r:e.target_type," (").concat(h(e.target_id),")"):"—"}),(0,a.jsx)(o.nA,{className:"text-sm text-slate-800 max-w-[200px] truncate",title:p(e),children:p(e)}),(0,a.jsx)(o.nA,{className:"text-xs text-slate-500 max-w-[120px] truncate",children:(s=e.details)&&0!==Object.keys(s).length?void 0!==s.delta?"Δ ".concat(Number(s.delta)>=0?"+":"").concat(s.delta):void 0!==s.value?"値: ".concat(s.value):void 0!==s.recipient_count?"対象: ".concat(s.recipient_count,"件"):s.fields&&Array.isArray(s.fields)?"項目: ".concat(s.fields.join(", ")):s.user_id?"user: ".concat(String(s.user_id).slice(0,8),"…"):JSON.stringify(s):"—"})]},e.id)})})]})]}),j.length>=200&&(0,a.jsx)("p",{className:"text-xs text-slate-500 text-center",children:"直近 200 件を表示しています。"})]})}},6633:(e,t,r)=>{"use strict";r.d(t,{A0:()=>i,BF:()=>d,Hj:()=>c,XI:()=>l,nA:()=>m,nd:()=>o});var a=r(5155),s=r(2115),n=r(5016);let l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{className:"relative w-full overflow-auto",children:(0,a.jsx)("table",{ref:t,className:(0,n.cn)("w-full caption-bottom text-sm",r),...s})})});l.displayName="Table";let i=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("thead",{ref:t,className:(0,n.cn)("[&_tr]:border-b",r),...s})});i.displayName="TableHeader";let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("tbody",{ref:t,className:(0,n.cn)("[&_tr:last-child]:border-0",r),...s})});d.displayName="TableBody";let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("tr",{ref:t,className:(0,n.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",r),...s})});c.displayName="TableRow";let o=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("th",{ref:t,className:(0,n.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",r),...s})});o.displayName="TableHead";let m=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("td",{ref:t,className:(0,n.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",r),...s})});m.displayName="TableCell"},7003:(e,t,r)=>{"use strict";r.d(t,{$:()=>c});var a=r(5155),s=r(2115),n=r(2467),l=r(3101),i=r(5016);let d=(0,l.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,t)=>{let{className:r,variant:s,size:l,asChild:c=!1,...o}=e,m=c?n.DX:"button";return(0,a.jsx)(m,{className:(0,i.cn)(d({variant:s,size:l,className:r})),ref:t,...o})});c.displayName="Button"},7812:(e,t,r)=>{"use strict";r.d(t,{E:()=>i});var a=r(5155);r(2115);var s=r(3101),n=r(5016);let l=(0,s.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground",secondary:"border-transparent bg-secondary text-secondary-foreground",destructive:"border-transparent bg-destructive text-destructive-foreground",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:r,...s}=e;return(0,a.jsx)("div",{className:(0,n.cn)(l({variant:r}),t),...s})}},9559:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(1847).A)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])}},e=>{e.O(0,[5707,7815,8441,1255,7358],()=>e(e.s=2334)),_N_E=e.O()}]);