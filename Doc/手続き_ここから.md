# ここからの手続き（管理ダッシュボードを動かすまで）

**管理画面のログイン情報（デフォルト）**
- **ログイン ID**: `admin`
- **パスワード**: `admin`  
※ 変更する場合は .env.local の `ADMIN_USER` / `ADMIN_PASSWORD` を設定。

---

## 1. care_messages テーブルを作る

1. [Supabase ダッシュボード](https://supabase.com/dashboard) を開く
2. このプロジェクトで使っている **プロジェクト** を選択
3. 左メニュー **SQL Editor** を開く
4. **New query** で新規クエリを開く
5. `supabase/002_create_care_messages_table.sql` の内容を **すべてコピー** して貼り付け
6. **Run** をクリックして実行
7. エラーが出なければ完了（すでにテーブルがある場合はエラーになることがあるが、そのままでも可）

※ `profiles` テーブルがまだない場合は、先に `001_create_profiles_table.sql` を同様に実行する。

※ ダッシュボードで「**最新ログイン**」（`updated_at`）と「**公式アカ友だち**」（`is_line_friend`）を表示する場合、`profiles` に `is_line_friend` カラムがまだなければ、SQL エディタで `supabase/003_add_is_line_friend_to_profiles.sql` を実行する。

---

## 2. アプリを起動する

プロジェクトのフォルダで:

```bash
npm install
npm run dev
```

表示された **http://localhost:3000**（または 3003 など）をブラウザで開く。

---

## 3. 管理画面にログインする

1. トップ画面で **「管理画面へ」** をクリック
2. ログイン画面で次を入力:
   - **ログイン**: `admin`
   - **パスワード**: `admin`
3. **ログイン** ボタンをクリック

→ 患者一覧（管理ダッシュボード）が表示されれば OK。

---

## 4. 個別メッセージを送る（任意）

1. 患者一覧の行にある **「メッセージ」** ボタンをクリック
2. 右からシートが開くので、定型文を選ぶか自由入力
3. **「送信して記録に保存」** をクリック

→ care_messages に保存される（.env.local に LINE の Channel ID/Secret があれば LINE にもプッシュ）。

---

## 5. 診察券番号・最終来院日を編集する（任意）

1. 患者一覧の行にある **「編集」** ボタンをクリック
2. ダイアログで **診察券番号** と **最終来院日** を入力・修正
3. **保存** をクリック

→ Supabase の profiles が更新され、一覧にすぐ反映される。

---

## まとめ

| 手順 | やること |
|------|----------|
| 1 | Supabase の SQL エディタで `002_create_care_messages_table.sql` を実行 |
| 2 | `npm run dev` で起動し、表示された URL を開く |
| 3 | 管理画面へ → ログイン `admin` / パスワード `admin` |
| 4 | （任意）患者の「メッセージ」で送信 |
| 5 | （任意）患者の「編集」で診察券番号・最終来院日を変更 |

.env.local には、すでに `NEXT_PUBLIC_SUPABASE_URL` と `NEXT_PUBLIC_SUPABASE_ANON_KEY` が入っていれば、上記だけで動く。

---

## GitHub にプッシュ → Vercel でデプロイする場合

### 準備（このリポジトリで一度だけ）

- **.gitignore** … すでに設定済み（`node_modules` / `.next` / `.env*` などはコミットされません）。
- **.env.example** … 環境変数の「キー一覧」だけをコミット用に用意済み。**実際の値は .env.local にのみ記載し、Git には含めません。**

### 手順

1. **GitHub にリポジトリを作成**
   - GitHub で New repository を作成（例: `managiment-apps-01`）。README / .gitignore は追加しない（既にローカルにあるため）。

2. **ローカルで Git 初期化〜プッシュ**（まだの場合）
   ```bash
   git init
   git add .
   git status   # .env.local や node_modules が含まれていないことを確認
   git commit -m "Initial commit: 管理ダッシュボード"
   git branch -M main
   git remote add origin https://github.com/<あなたのユーザー名>/<リポジトリ名>.git
   git push -u origin main
   ```

3. **Vercel でプロジェクトをインポート**
   - [Vercel](https://vercel.com) にログイン → **Add New** → **Project** → **Import Git Repository** で上記リポジトリを選択。
   - Framework Preset は **Next.js** のまま → **Deploy**。

4. **Vercel で環境変数を設定**
   - プロジェクトの **Settings** → **Environment Variables** を開く。
   - `.env.example` を参考に、本番で使う値を登録する（例: `NEXT_PUBLIC_SUPABASE_URL`, `NEXT_PUBLIC_SUPABASE_ANON_KEY`。必要なら `ADMIN_USER` / `ADMIN_PASSWORD` / `AUTH_SECRET` / LINE 用の変数）。
   - 保存後、**Deployments** から **Redeploy** すると反映される。

5. **動作確認**
   - Vercel の **Domains** に表示された URL（例: `https://xxx.vercel.app`）にアクセス → 「管理画面へ」→ ログインして患者一覧が表示されれば OK。
