# 管理ダッシュボード 今後のTODO / アイデアメモ

このファイルは、つくばホワイト歯科 管理ダッシュボードの  
「これからやること・やったほうが良さそうなこと」を整理するメモです。

---

## 1. ダッシュボード画面まわり

- **分析画面の充実**
  - いまは `profiles` だけを元にした簡易集計（スタンプ分布 / 友だち率 / 直近14日ログイン人数）。
  - 将来的には「ログイン履歴テーブル（例: activity_logs）」を追加して、日次・2週間ごとの推移グラフを出す。
  - 分析項目の候補:
    - ログイン回数の推移（直近14日 / 2週間ごと）
    - ミニアプリ起動回数（LIFF 側と連携した場合）
    - 来院無し期間ごとの患者数（6ヶ月以上来ていない人、など）。

- **フィルタ・ソートの拡張**
  - すでに「診察券番号 / スタンプ数 / 最終来院 / 最新ログイン / 公式アカ友だち」でソート可能。
  - 追加したいもの:
    - 「公式アカ友だちだけ」「直近14日以内にログインした人だけ」などの**絞り込みチェックボックス**。
    - スタンプ数の範囲指定（例: 5個以上 / 10個以上）。

- **UI/UX の磨き込み**
  - 患者一覧の行をクリックしたときに、右側に簡易プロフィールパネルを出す（過去メッセージやスタンプ履歴のサマリ）。
  - モバイル表示（タブレット）での見え方を調整する（列の折り返し、ボタンの並び）。

---

## 2. メッセージ機能まわり

- **メッセージテンプレートの管理画面**
  - いまはコンポーネント内に定義している定型文を、DB（例: message_templates）で管理できるようにする。
  - 管理画面から「追加 / 編集 / 削除」ができるようにする。

- **一斉送信の土台**
  - 条件指定の例:
    - スタンプ数◯個以上
    - 最終来院日が◯ヶ月以上前
    - 公式アカ友だちのみ
  - いきなり本番送信せず、まずは「対象者一覧のプレビュー」と「テスト送信（1人だけ）」を用意する。

- **送信履歴の一覧**
  - `care_messages` を元に、「いつ誰にどんなメッセージを送ったか」を一覧・検索できる画面。
  - 将来的には「分析画面」とも連動（どのメッセージが反応が良いか、など）。

---

## 3. 認証・権限まわり

- **管理ユーザーの複数化**
  - いまは簡易認証（admin / パスワード）1パターンのみ。
  - 将来的には「閲覧のみ」「スタンプ編集可」「メッセージ送信可」などのロール分けを検討。

- **ログイン履歴の保存**
  - `activity_logs` テーブルを導入し、管理画面ログイン成功時に `login` イベントを記録。
  - これを使って「だれがどのくらいシステムを使っているか」を分析画面に反映。

---

## 4. パフォーマンス・運用

- **大量データ時のパフォーマンス**
  - 患者数が増えたときのために、ページネーションや無限スクロールを検討。
  - API 側でのサーバーサイド検索・ソートの導入。

- **本番運用時のログ・監視**
  - エラー時の通知（例: Vercel + Sentry）を検討。
  - Supabase のログを使った不正アクセス検知（将来的な話）。

---

## 5. 今すぐやる候補 / 後回し候補

- **今すぐやると便利そうなもの**
  - 分析画面に「CSV ダウンロード（スタンプ分布・友だち一覧）」ボタンを追加。
  - 患者一覧で「公式アカ友だちだけ表示」のフィルタトグル。

- **余裕が出たらやるもの**
  - activity_logs を使った本格的な利用状況グラフ。
  - 一斉送信ウィザード（条件 → 対象確認 → メッセージ作成 → 送信）の実装。

